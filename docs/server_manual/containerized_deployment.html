<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. Containerized deployment &mdash; QGIS Documentation  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/qgis_docs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/qgis_topbar.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/server_manual/containerized_deployment.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8. Frequently Asked Question" href="faq.html" />
    <link rel="prev" title="6. Development Server" href="development_server.html" /> 
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
    <div class="row isTesting">
     This documentation is a work in progress. For the Long Term Release and translations, please visit the <a href="https://docs.qgis.org/latest/en/docs/server_manual/containerized_deployment.html">latest version</a>.
    </div>
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   
            <a href="../index.html" class="icon icon-home"> QGIS Documentation
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                testing
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktop User Guide/Manual (QGIS Testing)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">QGIS Server Guide/Manual (QGIS Testing)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html">2. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html">3. Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">4. Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">5. Advanced configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="development_server.html">6. Development Server</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Containerized deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-docker-images">7.1. Simple docker images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#first-run">7.1.1. First run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usable-sample">7.1.2. Usable sample</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleanup">7.1.3. Cleanup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker-stacks">7.2. Docker stacks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#swarm-docker-compose">7.2.1. Swarm/docker-compose</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kubernetes">7.2.2. Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cloud-deployment">7.3. Cloud deployment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#aws-usecase">7.3.1. AWS usecase</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">8. Frequently Asked Question</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">Training Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Writers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">Documentation Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyqgis_developer_cookbook/index.html">PyQGIS Cookbook (QGIS Testing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">Developers Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">QGIS Server Guide/Manual</a> &raquo;</li>
      <li><span class="section-number">7. </span>Containerized deployment</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/server_manual/containerized_deployment.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="development_server.html" class="btn btn-neutral float-left" title="6. Development Server" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="8. Frequently Asked Question" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="containerized-deployment">
<h1><span class="section-number">7. </span>Containerized deployment<a class="headerlink" href="#containerized-deployment" title="Permalink to this headline">ÔÉÅ</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#simple-docker-images" id="id5">Simple docker images</a></p>
<ul>
<li><p><a class="reference internal" href="#first-run" id="id6">First run</a></p></li>
<li><p><a class="reference internal" href="#usable-sample" id="id7">Usable sample</a></p></li>
<li><p><a class="reference internal" href="#cleanup" id="id8">Cleanup</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#docker-stacks" id="id9">Docker stacks</a></p>
<ul>
<li><p><a class="reference internal" href="#swarm-docker-compose" id="id10">Swarm/docker-compose</a></p>
<ul>
<li><p><a class="reference internal" href="#stack-description" id="id11">Stack description</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id12">Cleanup</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#kubernetes" id="id13">Kubernetes</a></p>
<ul>
<li><p><a class="reference internal" href="#installation" id="id14">Installation</a></p></li>
<li><p><a class="reference internal" href="#creating-manifests" id="id15">Creating manifests</a></p></li>
<li><p><a class="reference internal" href="#deploying-manifests" id="id16">Deploying manifests</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id17">Cleanup</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#cloud-deployment" id="id18">Cloud deployment</a></p>
<ul>
<li><p><a class="reference internal" href="#aws-usecase" id="id19">AWS usecase</a></p></li>
</ul>
</li>
</ul>
</div>
<p>There are many ways to use containerized application, from the most
simple (simple Docker images) to sophisticated (Kubernetes and so on).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This kind of deployment needs the
<a class="reference external" href="https://www.docker.com">docker application</a> to be installed and
running.
Check this <a class="reference external" href="https://www.docker.com/101-tutorial">tutorial</a>.</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Docker run pre packaged application (aka images)
which can be retrieved as sources (Dockerfile and resources) to
build or already built from registries (private or public).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>QGIS Debian-Ubuntu package downloads need a valid gpg authentication key.
Please refer to the <a class="reference external" href="https://www.qgis.org/fr/site/forusers/alldownloads.html#debian-ubuntu">installation pages</a>
to update the following Dockerfile with the latest key and its fingerprint value</p>
</div>
<section id="simple-docker-images">
<span id="id1"></span><h2><a class="toc-backref" href="#id5"><span class="section-number">7.1. </span>Simple docker images</a><a class="headerlink" href="#simple-docker-images" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>As the docker image does not exist in a public registry. you will need to build
it. To do so create a directory <code class="file docutils literal notranslate"><span class="pre">qgis-server</span></code> and within its directory:</p>
<ul class="simple">
<li><p>create a file <code class="file docutils literal notranslate"><span class="pre">Dockerfile</span></code> with this content:</p></li>
</ul>
<div class="highlight-dockerfile notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span> <span class="s">debian:buster-slim</span>

<span class="k">ENV</span> <span class="nv">LANG</span><span class="o">=</span>en_EN.UTF-8


<span class="k">RUN</span> apt-get update <span class="se">\</span>
    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests --allow-unauthenticated -y <span class="se">\</span>
        gnupg <span class="se">\</span>
        ca-certificates <span class="se">\</span>
        wget <span class="se">\</span>
        locales <span class="se">\</span>
    <span class="o">&amp;&amp;</span> localedef -i en_US -f UTF-8 en_US.UTF-8 <span class="se">\</span>
    # Add the current key <span class="k">for</span> package downloading - As the key changes every year at least
    # Please refer to QGIS install documentation and replace it and its fingerprint value with the latest ones
    <span class="o">&amp;&amp;</span> wget -O - https://qgis.org/downloads/qgis-2021.gpg.key <span class="p">|</span> gpg --import <span class="se">\</span>
    <span class="o">&amp;&amp;</span> gpg --export --armor 46B5721DBBD2996A <span class="p">|</span> apt-key add - <span class="se">\</span>
    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;deb http://qgis.org/debian buster main&quot;</span> &gt;&gt; /etc/apt/sources.list.d/qgis.list <span class="se">\</span>
    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\</span>
    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests --allow-unauthenticated -y <span class="se">\</span>
        qgis-server <span class="se">\</span>
        spawn-fcgi <span class="se">\</span>
        xauth <span class="se">\</span>
        xvfb <span class="se">\</span>
    <span class="o">&amp;&amp;</span> apt-get remove --purge -y <span class="se">\</span>
        gnupg <span class="se">\</span>
        wget <span class="se">\</span>
    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*

<span class="k">RUN</span> useradd -m qgis

<span class="k">ENV</span> TINI_VERSION v0.17.0
<span class="k">ADD</span> https://github.com/krallin/tini/releases/download/<span class="si">${</span><span class="nv">TINI_VERSION</span><span class="si">}</span>/tini /tini
<span class="k">RUN</span> chmod +x /tini

<span class="k">ENV</span> QGIS_PREFIX_PATH /usr
<span class="k">ENV</span> QGIS_SERVER_LOG_STDERR <span class="m">1</span>
<span class="k">ENV</span> QGIS_SERVER_LOG_LEVEL <span class="m">2</span>

<span class="k">COPY</span> cmd.sh /home/qgis/cmd.sh
<span class="k">RUN</span> chmod -R <span class="m">777</span> /home/qgis/cmd.sh
<span class="k">RUN</span> chown qgis:qgis /home/qgis/cmd.sh

<span class="k">USER</span><span class="s"> qgis</span>
<span class="k">WORKDIR</span><span class="s"> /home/qgis</span>

<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/tini&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>

<span class="k">CMD</span> <span class="p">[</span><span class="s2">&quot;/home/qgis/cmd.sh&quot;</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>create a file <code class="file docutils literal notranslate"><span class="pre">cmd.sh</span></code> with this content:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="o">[[</span> <span class="nv">$DEBUG</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> env

<span class="nb">exec</span> /usr/bin/xvfb-run --auto-servernum --server-num<span class="o">=</span><span class="m">1</span> /usr/bin/spawn-fcgi -p <span class="m">5555</span> -n -d /home/qgis -- /usr/lib/cgi-bin/qgis_mapserv.fcgi
</pre></div>
</div>
<ul class="simple">
<li><p>build the image with:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -f Dockerfile -t qgis-server ./
</pre></div>
</div>
<section id="first-run">
<h3><a class="toc-backref" href="#id6"><span class="section-number">7.1.1. </span>First run</a><a class="headerlink" href="#first-run" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>To run the server you will need a QGIS project file. You can use one of yours or pick
<a class="reference external" href="https://gitlab.com/Oslandia/qgis/docker-qgis/-/blob/cc1798074d4a66a472721352f3984bb318777a5a/qgis-exec/data/osm.qgs">this sample</a>.</p>
<p>To do so, create a directory <code class="file docutils literal notranslate"><span class="pre">data</span></code> within the directory
<code class="file docutils literal notranslate"><span class="pre">qgis-server</span></code> and copy your file in it. To comply with the following
explanations, rename it to <code class="file docutils literal notranslate"><span class="pre">osm.qgs</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may need to add advertised URLs under the <span class="guilabel">QGIS Server</span> tab of the
<span class="menuselection">Project ‚ñ∫ Properties</span> if the GetCapabilites are broken.
For example if your server is exposed on port 8080, you will put this for
advertised URL <code class="docutils literal notranslate"><span class="pre">http://localhost:8080/qgis-server/</span></code>. More information
available in section <a class="reference internal" href="getting_started.html#creatingwmsfromproject"><span class="std std-ref">Configure your project</span></a> and subsequent.</p>
</div>
<p>Now, you can run the server with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker network create qgis
docker run -d --rm --name qgis-server --net<span class="o">=</span>qgis --hostname<span class="o">=</span>qgis-server <span class="se">\</span>
              -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/data:/data:ro -p <span class="m">5555</span>:5555 <span class="se">\</span>
              -e <span class="s2">&quot;QGIS_PROJECT_FILE=/data/osm.qgs&quot;</span> <span class="se">\</span>
              qgis-server
</pre></div>
</div>
<p>Options used:</p>
<ul class="simple">
<li><p><strong>-d</strong>: run in the background</p></li>
<li><p><strong>‚Äìrm</strong>: remove the container when it is stopped</p></li>
<li><p><strong>‚Äìname</strong>: name of the container to be created</p></li>
<li><p><strong>‚Äìnet</strong>: (previously created) sub network</p></li>
<li><p><strong>‚Äìhostname</strong>: container hostname, for later referencing</p></li>
<li><p><strong>-v</strong>: local data directory to be mounted in the container</p></li>
<li><p><strong>-p</strong>: host/container port mapping</p></li>
<li><p><strong>-e</strong>: environment variable to be used in the container</p></li>
</ul>
<p>To check, type <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">qgis-server</span></code> and you should see a
line with <strong>qgis-server</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONTAINER</span> <span class="n">ID</span>   <span class="n">IMAGE</span>         <span class="n">COMMAND</span>                  <span class="n">CREATED</span>         <span class="n">STATUS</span>         <span class="n">PORTS</span>                    <span class="n">NAMES</span>
<span class="mi">4</span><span class="n">de8192da76e</span>   <span class="n">qgis</span><span class="o">-</span><span class="n">server</span>   <span class="s2">&quot;/tini -- /home/qgis‚Ä¶&quot;</span>   <span class="mi">3</span> <span class="n">seconds</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="mi">2</span> <span class="n">seconds</span>   <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">5555</span><span class="o">-&gt;</span><span class="mi">5555</span><span class="o">/</span><span class="n">tcp</span>   <span class="n">qgis</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
</section>
<section id="usable-sample">
<h3><a class="toc-backref" href="#id7"><span class="section-number">7.1.2. </span>Usable sample</a><a class="headerlink" href="#usable-sample" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>As the server is only accepting fastcgi connections, you need
an HTTP server that handles this protocol.
To do so we have to create a simple Nginx configuration file and start
a Nginx image.</p>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">nginx.conf</span></code> in the current directory with this
content:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span class="k">server</span> <span class="p">{</span>
  <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
  <span class="kn">server_name</span> <span class="s">_</span><span class="p">;</span>
  <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
    <span class="kn">root</span>  <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
    <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kn">location</span> <span class="s">/qgis-server</span> <span class="p">{</span>
    <span class="kn">proxy_buffers</span> <span class="mi">16</span> <span class="mi">16k</span><span class="p">;</span>
    <span class="kn">proxy_buffer_size</span> <span class="mi">16k</span><span class="p">;</span>
    <span class="kn">gzip</span> <span class="no">off</span><span class="p">;</span>
    <span class="kn">include</span> <span class="s">fastcgi_params</span><span class="p">;</span>
    <span class="kn">fastcgi_pass</span> <span class="n">qgis-server</span><span class="p">:</span><span class="mi">5555</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And type this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run -d --rm --name nginx --net<span class="o">=</span>qgis --hostname<span class="o">=</span>nginx <span class="se">\</span>
              -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/nginx.conf:/etc/nginx/conf.d/default.conf:ro -p <span class="m">8080</span>:80 <span class="se">\</span>
              nginx:1.13
</pre></div>
</div>
<p>To check capabilities availability, type in a browser
<a class="reference external" href="http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="cleanup">
<h3><a class="toc-backref" href="#id8"><span class="section-number">7.1.3. </span>Cleanup</a><a class="headerlink" href="#cleanup" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>To cleanup the running images, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker stop qgis-server nginx
</pre></div>
</div>
</section>
</section>
<section id="docker-stacks">
<span id="id2"></span><h2><a class="toc-backref" href="#id9"><span class="section-number">7.2. </span>Docker stacks</a><a class="headerlink" href="#docker-stacks" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>The previous method is scriptable, but not easily packageable nor
standardized or easily manageable.</p>
<p>To work with a docker image set you could use a docker stack managed
by an orchestrator.
In a stack, the images are working in the same private network, and
you can start / stop the whole stack or deploy the stack to other
workers.
There are many orchestrators, for example Swarm, Kubernetes and Mesos.</p>
<p>In the following, we will present simple configurations for testing
purposes.
They are not suitable for production.</p>
<section id="swarm-docker-compose">
<h3><a class="toc-backref" href="#id10"><span class="section-number">7.2.1. </span>Swarm/docker-compose</a><a class="headerlink" href="#swarm-docker-compose" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Docker now has its own orchestrator: Swarm (compatible with docker-compose
files). You have to
<a class="reference external" href="https://docs.docker.com/get-started/orchestration/#enable-docker-swarm">enable it</a>
(the Mac version will also work with Linux).</p>
<section id="stack-description">
<span id="docker-compose-file"></span><h4><a class="toc-backref" href="#id11"><span class="section-number">7.2.1.1. </span>Stack description</a><a class="headerlink" href="#stack-description" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>Now that you have Swarm working, create the service file (see
<a class="reference external" href="https://docs.docker.com/get-started/swarm-deploy/">Deploy to Swarm</a>)
<code class="file docutils literal notranslate"><span class="pre">qgis-stack.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&#39;3.7&#39;</span>

<span class="nt">services</span><span class="p">:</span>
  <span class="nt">qgis-server</span><span class="p">:</span>
    <span class="c1"># Should use version with utf-8 locale support:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server:latest</span>
    <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/data:/data:ro</span>
    <span class="nt">environment</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">LANG=en_EN.UTF-8</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QGIS_PROJECT_FILE=/data/osm.qgs</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">QGIS_SERVER_LOG_LEVEL=0</span>  <span class="c1"># INFO (log all requests)</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG=1</span>                  <span class="c1"># display env before spawning QGIS Server</span>

  <span class="nt">nginx</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.13</span>
    <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">8080:80</span>
    <span class="nt">volumes</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/nginx.conf:/etc/nginx/conf.d/default.conf:ro</span>
    <span class="nt">depends_on</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
</pre></div>
</div>
<p>To deploy (or update) the stack, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker stack deploy -c qgis-stack.yaml qgis-stack
</pre></div>
</div>
<p>Check the stack deployment status until you obtain <strong>1/1</strong> in the
<strong>replicas</strong> column:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker stack services qgis-stack
</pre></div>
</div>
<p>Something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID</span>                  <span class="n">NAME</span>                <span class="n">MODE</span>                <span class="n">REPLICAS</span>            <span class="n">IMAGE</span>               <span class="n">PORTS</span>
<span class="n">gmx7ewlvwsqt</span>        <span class="n">qgis_nginx</span>          <span class="n">replicated</span>          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>                 <span class="n">nginx</span><span class="p">:</span><span class="mf">1.13</span>          <span class="o">*</span><span class="p">:</span><span class="mi">8080</span><span class="o">-&gt;</span><span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>
<span class="n">l0v2e7cl43u3</span>        <span class="n">qgis_qgis</span><span class="o">-</span><span class="n">server</span>    <span class="n">replicated</span>          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>                 <span class="n">qgis</span><span class="o">-</span><span class="n">server</span><span class="p">:</span><span class="n">latest</span>
</pre></div>
</div>
<p>To check WMS capabilities, type in a web browser
<a class="reference external" href="http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:8080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="id3">
<h4><a class="toc-backref" href="#id12"><span class="section-number">7.2.1.2. </span>Cleanup</a><a class="headerlink" href="#id3" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>To cleanup, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker stack rm qgis-stack
</pre></div>
</div>
</section>
</section>
<section id="kubernetes">
<h3><a class="toc-backref" href="#id13"><span class="section-number">7.2.2. </span>Kubernetes</a><a class="headerlink" href="#kubernetes" title="Permalink to this headline">ÔÉÅ</a></h3>
<section id="installation">
<h4><a class="toc-backref" href="#id14"><span class="section-number">7.2.2.1. </span>Installation</a><a class="headerlink" href="#installation" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>If you have a <strong>Docker Desktop</strong> installation, using Kubernetes (aka
k8s) is pretty straight forward:
<a class="reference external" href="https://docs.docker.com/get-started/orchestration/#enable-kubernetes">enable k8s</a>.</p>
<p>If not, follow the
<a class="reference external" href="https://kubernetes.io/docs/tutorials/hello-minikube/">minikube tutorial</a>
or
<a class="reference external" href="https://ubuntu.com/tutorials/install-a-local-kubernetes-with-microk8s">microk8s for Ubuntu</a>.</p>
<p>As Kubernetes installation can be really complex, we will only focus
on aspects used by this demo.
For further / deeper information, check the
<a class="reference external" href="https://kubernetes.io/docs/home/">official documentation</a>.</p>
<section id="microk8s">
<h5><span class="section-number">7.2.2.1.1. </span>microk8s<a class="headerlink" href="#microk8s" title="Permalink to this headline">ÔÉÅ</a></h5>
<p>microk8s needs extra steps: you have to enable the registry and tag
the qgis-server image in order to have Kubernetes to find the created
images.</p>
<p>First, enable the registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>microk8s <span class="nb">enable</span> dashboard dns registry
</pre></div>
</div>
<p>Then, tag and push the image to your newly created registry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker tag qgis-server <span class="m">127</span>.0.0.1:32000/qgis-server <span class="o">&amp;&amp;</span> docker push <span class="m">127</span>.0.0.1:32000/qgis-server
</pre></div>
</div>
<p>Finally, add or complete the <code class="file docutils literal notranslate"><span class="pre">/etc/docker/daemon.json</span></code> to have
your registry <strong>127.0.0.1:32000</strong> listed in the
<strong>insecure-registries</strong> field:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;insecure-registries&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;127.0.0.1:32000&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="creating-manifests">
<span id="k8s-manifests"></span><h4><a class="toc-backref" href="#id15"><span class="section-number">7.2.2.2. </span>Creating manifests</a><a class="headerlink" href="#creating-manifests" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>Kubernetes describes the objects to deploy in yaml manifests.
There are many different kinds, but we will only use deployments
(handle pods, i.e. docker images) and services to expose the
deployments to internal or external purposes.</p>
<section id="deployment-manifests">
<h5><span class="section-number">7.2.2.2.1. </span>Deployment manifests<a class="headerlink" href="#deployment-manifests" title="Permalink to this headline">ÔÉÅ</a></h5>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">deployments.yaml</span></code> with this content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">localhost:32000/qgis-server:latest</span>
          <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
          <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LANG</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">en_EN.UTF-8</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">QGIS_PROJECT_FILE</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/osm.qgs</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">QGIS_SERVER_LOG_LEVEL</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;0&quot;</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DEBUG</span>
              <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;1&quot;</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5555</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-data</span>
              <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/data/</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-data</span>
          <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/data</span>

<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
          <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.13</span>
          <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-conf</span>
              <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/nginx/conf.d/default.conf</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx-conf</span>
          <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">REPLACE_WITH_FULL_PATH/nginx.conf</span>
</pre></div>
</div>
</section>
<section id="service-manifests">
<h5><span class="section-number">7.2.2.2.2. </span>Service manifests<a class="headerlink" href="#service-manifests" title="Permalink to this headline">ÔÉÅ</a></h5>
<p>Create a file <code class="file docutils literal notranslate"><span class="pre">services.yaml</span></code> with this content:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-server</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5555</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5555</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Service</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">myLabel</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">qgis-nginx</span>
  <span class="nt">ports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="nt">targetPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
      <span class="nt">nodePort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30080</span>
</pre></div>
</div>
</section>
</section>
<section id="deploying-manifests">
<h4><a class="toc-backref" href="#id16"><span class="section-number">7.2.2.3. </span>Deploying manifests</a><a class="headerlink" href="#deploying-manifests" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>To deploy the images and services in Kubernetes, one can use the
dashboard (click on the <strong>+</strong> on the upper right) or the command line.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using the command line with microk8s you will have to prefix
each command with <cite>microk8s</cite>.</p>
</div>
<p>To deploy or update your manifests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl apply -k ./
</pre></div>
</div>
<p>To check what is currently deployed:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl get pods,services,deployment
</pre></div>
</div>
<p>You should obtain something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                               <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">pod</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span><span class="o">-</span><span class="mi">54845</span><span class="n">ff6f6</span><span class="o">-</span><span class="mi">8</span><span class="n">skp9</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">27</span><span class="n">m</span>
<span class="n">pod</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mi">75</span><span class="n">df8ddd89</span><span class="o">-</span><span class="n">c7t7s</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">27</span><span class="n">m</span>

<span class="n">NAME</span>                       <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>       <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>        <span class="n">AGE</span>
<span class="n">service</span><span class="o">/</span><span class="n">Kubernetes</span>         <span class="n">ClusterIP</span>   <span class="mf">10.152.183.1</span>     <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">443</span><span class="o">/</span><span class="n">TCP</span>        <span class="mi">5</span><span class="n">h51m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">exec</span><span class="o">-</span><span class="n">server</span>   <span class="n">ClusterIP</span>   <span class="mf">10.152.183.218</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">5555</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">35</span><span class="n">m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span>         <span class="n">NodePort</span>    <span class="mf">10.152.183.234</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">80</span><span class="p">:</span><span class="mi">30080</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">27</span><span class="n">m</span>
<span class="n">service</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span>        <span class="n">ClusterIP</span>   <span class="mf">10.152.183.132</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">5555</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">27</span><span class="n">m</span>

<span class="n">NAME</span>                          <span class="n">READY</span>   <span class="n">UP</span><span class="o">-</span><span class="n">TO</span><span class="o">-</span><span class="n">DATE</span>   <span class="n">AVAILABLE</span>   <span class="n">AGE</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">nginx</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="mi">1</span>            <span class="mi">1</span>           <span class="mi">27</span><span class="n">m</span>
<span class="n">deployment</span><span class="o">.</span><span class="n">apps</span><span class="o">/</span><span class="n">qgis</span><span class="o">-</span><span class="n">server</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="mi">1</span>            <span class="mi">1</span>           <span class="mi">27</span><span class="n">m</span>
</pre></div>
</div>
<p>To read nginx/qgis logs, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl logs -f POD_NAME
</pre></div>
</div>
<p>To check WMS capabilities, type in a web browser
<a class="reference external" href="http://localhost:30080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities">http://localhost:30080/qgis-server/?SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetCapabilities</a></p>
</section>
<section id="id4">
<h4><a class="toc-backref" href="#id17"><span class="section-number">7.2.2.4. </span>Cleanup</a><a class="headerlink" href="#id4" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>To clean up, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl delete -n default service/qgis-server service/qgis-nginx deployment/qgis-nginx deployment/qgis-server
</pre></div>
</div>
</section>
</section>
</section>
<section id="cloud-deployment">
<h2><a class="toc-backref" href="#id18"><span class="section-number">7.3. </span>Cloud deployment</a><a class="headerlink" href="#cloud-deployment" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>Managing your own cluster of servers to handle the deployment of
containerized applications, is a complex job.
You have to handle multiple issues, such as hardware, bandwidth and
security at different levels.</p>
<p>Cloud deployment solutions can be a good alternative when you do not
want to focus on infrastructure management.</p>
<p>A cloud deployment may use proprietary mechanisms, but they are also
compatible with the stages explained previously
(<a class="reference internal" href="#simple-docker-images"><span class="std std-ref">docker images</span></a> and
<a class="reference internal" href="#docker-stacks"><span class="std std-ref">stack management</span></a>).</p>
<section id="aws-usecase">
<h3><a class="toc-backref" href="#id19"><span class="section-number">7.3.1. </span>AWS usecase</a><a class="headerlink" href="#aws-usecase" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>With Amazon AWS, through
<a class="reference external" href="https://console.aws.amazon.com/ecs/home">ECS (Elastic Container Service)</a>
functionalities, you can use docker-compose or Kubernetes compatible
wrappers to manage your stack.
You will have to create an
<a class="reference external" href="https://console.aws.amazon.com/ecr/home">image registry</a> for your
custom images to be accessible.</p>
<p>To use docker-compose alike functionalities, you need to install the
<strong>ecs-cli</strong> client and have <a class="reference external" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_execution_IAM_role.html">proper permissions / roles</a>.
Then, with the help of the <cite>ecs-cli compose</cite> commands (see the
<a class="reference external" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/cmd-ecs-cli-compose.html">ecs-cli compose manual</a>
and
<a class="reference external" href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-cli-tutorial-fargate.html">ecs-cli tutorial</a>),
you can reuse the <a class="reference internal" href="#docker-compose-file"><span class="std std-ref">stack description</span></a>.</p>
<p>To use Kubernetes, you can use the AWS web console or the command line
tool
<a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/getting-started.html">eksctl</a>
and have the proper permissions / roles. Then with a well configured
kubectl environment, you can reuse the <a class="reference internal" href="#k8s-manifests"><span class="std std-ref">Kubernetes manifests</span></a>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="development_server.html" class="btn btn-neutral float-left" title="6. Development Server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="faq.html" class="btn btn-neutral float-right" title="8. Frequently Asked Question" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">Last updated on Oct 19, 2021 22:25.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages
example of expected format: .../locale-en-lc-messages-docs-gentle-gis-introduction-data-capture-po--release-3-16 
for the page ...3.16/docs/gentle_gis_introduction/data_capture.html in release_3.16 branch-->
<!--Make sure that mismatching languages codes are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: testing
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/server_manual/containerized_deployment.html">en</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/server_manual/containerized_deployment.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/en/docs/server_manual/containerized_deployment.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/en/docs/server_manual/containerized_deployment.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/en/docs/server_manual/containerized_deployment.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/en/docs/server_manual/containerized_deployment.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/en/docs/server_manual/containerized_deployment.html">2.18</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.14/en/docs/server_manual/containerized_deployment.html">2.14</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.8/en/docs/server_manual/containerized_deployment.html">2.8</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.6/en/docs/server_manual/containerized_deployment.html">2.6</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.2/en/docs/server_manual/containerized_deployment.html">2.2</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.0/en/docs/server_manual/containerized_deployment.html">2.0</a></dd>
        
          <dd><a href="https://docs.qgis.org/1.8/en/docs/server_manual/containerized_deployment.html">1.8</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/testing/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/testing/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/server_manual/containerized_deployment.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/en" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/master" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/master" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>