<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9. Using the Map Canvas &mdash; QGIS Documentation  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/qgis_docs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/qgis_topbar.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/canvas.html"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10. Map Rendering and Printing" href="composer.html" />
    <link rel="prev" title="8. Projections Support" href="crs.html" /> 
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
    <div class="row isTesting">
     This documentation is a work in progress. For the Long Term Release and translations, please visit the <a href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/canvas.html">latest version</a>.
    </div>
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   
            <a href="../index.html" class="icon icon-home"> QGIS Documentation
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                testing
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Wageningen Students</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../land_degradation_development/index.html">Land Degradation and Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_manual/index.html">QGIS Desktop User Guide/Manual (QGIS Testing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_manual/index.html">QGIS Server Guide/Manual (QGIS Testing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../training_manual/index.html">Training Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Writers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../documentation_guidelines/index.html">Documentation Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PyQGIS Cookbook (QGIS Testing)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadproject.html">2. Loading Projects</a></li>
<li class="toctree-l2"><a class="reference internal" href="loadlayer.html">3. Loading Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="legend.html">4. Accessing the Table Of Contents (TOC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="raster.html">5. Using Raster Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="vector.html">6. Using Vector Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="geometry.html">7. Geometry Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="crs.html">8. Projections Support</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">9. Using the Map Canvas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#embedding-map-canvas">9.1. Embedding Map Canvas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rubber-bands-and-vertex-markers">9.2. Rubber Bands and Vertex Markers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-map-tools-with-canvas">9.3. Using Map Tools with Canvas</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#select-a-feature-using-qgsmaptoolidentifyfeature">9.3.1. Select a feature using QgsMapToolIdentifyFeature</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#writing-custom-map-tools">9.4. Writing Custom Map Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-custom-map-canvas-items">9.5. Writing Custom Map Canvas Items</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="composer.html">10. Map Rendering and Printing</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">11. Expressions, Filtering and Calculating Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html">12. Reading And Storing Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="communicating.html">13. Communicating with the user</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">14. Authentication infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">15. Tasks - doing heavy work in the background</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins/index.html">16. Developing Python Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="processing.html">17. Writing a Processing plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluginlayer.html">18. Using Plugin Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="network_analysis.html">19. Network analysis library</a></li>
<li class="toctree-l2"><a class="reference internal" href="server.html">20. QGIS Server and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="cheat_sheet.html">21. Cheat sheet for PyQGIS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developers_guide/index.html">Developers Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">PyQGIS Developer Cookbook</a> &raquo;</li>
      <li><span class="section-number">9. </span>Using the Map Canvas</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/pyqgis_developer_cookbook/canvas.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="crs.html" class="btn btn-neutral float-left" title="8. Projections Support" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="composer.html" class="btn btn-neutral float-right" title="10. Map Rendering and Printing" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-the-map-canvas">
<span id="canvas"></span><span id="index-0"></span><h1><span class="section-number">9. </span>Using the Map Canvas<a class="headerlink" href="#using-the-map-canvas" title="Permalink to this headline"></a></h1>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The code snippets on this page need the following imports if you’re outside the pyqgis console:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 2</span>    <span class="n">QColor</span><span class="p">,</span>
<span class="linenos"> 3</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QRectF</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 8</span>    <span class="n">QgsVectorLayer</span><span class="p">,</span>
<span class="linenos"> 9</span>    <span class="n">QgsPoint</span><span class="p">,</span>
<span class="linenos">10</span>    <span class="n">QgsPointXY</span><span class="p">,</span>
<span class="linenos">11</span>    <span class="n">QgsProject</span><span class="p">,</span>
<span class="linenos">12</span>    <span class="n">QgsGeometry</span><span class="p">,</span>
<span class="linenos">13</span>    <span class="n">QgsMapRendererJob</span><span class="p">,</span>
<span class="linenos">14</span><span class="p">)</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos">17</span>    <span class="n">QgsMapCanvas</span><span class="p">,</span>
<span class="linenos">18</span>    <span class="n">QgsVertexMarker</span><span class="p">,</span>
<span class="linenos">19</span>    <span class="n">QgsMapCanvasItem</span><span class="p">,</span>
<span class="linenos">20</span>    <span class="n">QgsRubberBand</span><span class="p">,</span>
<span class="linenos">21</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#embedding-map-canvas" id="id1">Embedding Map Canvas</a></p></li>
<li><p><a class="reference internal" href="#rubber-bands-and-vertex-markers" id="id2">Rubber Bands and Vertex Markers</a></p></li>
<li><p><a class="reference internal" href="#using-map-tools-with-canvas" id="id3">Using Map Tools with Canvas</a></p>
<ul>
<li><p><a class="reference internal" href="#select-a-feature-using-qgsmaptoolidentifyfeature" id="id4">Select a feature using QgsMapToolIdentifyFeature</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#writing-custom-map-tools" id="id5">Writing Custom Map Tools</a></p></li>
<li><p><a class="reference internal" href="#writing-custom-map-canvas-items" id="id6">Writing Custom Map Canvas Items</a></p></li>
</ul>
</div>
<p>The Map canvas widget is probably the most important widget within QGIS because
it shows the map composed from overlaid map layers and allows interaction with
the map and layers. The canvas always shows a part of the map defined by the
current canvas extent. The interaction is done through the use of <strong>map tools</strong>:
there are tools for panning, zooming, identifying layers, measuring, vector
editing and others. Similar to other graphics programs, there is always one
tool active and the user can switch between the available tools.</p>
<p>The map canvas is implemented with the <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapCanvas</span></code></a>
class in the <a class="reference external" href="https://qgis.org/pyqgis/master/gui">qgis.gui</a>
module. The implementation is based on the Qt Graphics View framework.
This framework generally provides a surface and a view where custom graphics
items are placed and user can interact with them.  We will assume that you are
familiar enough with Qt to understand the concepts of the graphics scene, view
and items. If not, please read the <a class="reference external" href="https://doc.qt.io/qt-5/graphicsview.html">overview of the framework</a>.</p>
<p>Whenever the map has been panned, zoomed in/out (or some other action that triggers
a refresh), the map is rendered again within the current extent. The layers are
rendered to an image (using the <a class="reference external" href="https://qgis.org/pyqgis/master/core/QgsMapRendererJob.html#qgis.core.QgsMapRendererJob" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapRendererJob</span></code></a> class) and that image is
displayed on the canvas. The <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapCanvas</span></code></a> class also controls refreshing
of the rendered map. Besides this item which acts as a background, there may be more <strong>map canvas items</strong>.</p>
<p>Typical map canvas items are rubber bands (used for measuring, vector editing
etc.) or vertex markers. The canvas items are usually used to give visual
feedback for map tools, for example, when creating a new polygon, the map tool
creates a rubber band canvas item that shows the current shape of the polygon.
All map canvas items are subclasses of <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapCanvasItem.html#qgis.gui.QgsMapCanvasItem" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapCanvasItem</span></code></a>  which adds
some more functionality to the basic <code class="docutils literal notranslate"><span class="pre">QGraphicsItem</span></code> objects.</p>
<p id="index-1">To summarize, the map canvas architecture consists of three concepts:</p>
<ul class="simple">
<li><p>map canvas — for viewing of the map</p></li>
<li><p>map canvas items — additional items that can be displayed on the map canvas</p></li>
<li><p>map tools — for interaction with the map canvas</p></li>
</ul>
<section id="embedding-map-canvas">
<span id="index-2"></span><h2><a class="toc-backref" href="#id1"><span class="section-number">9.1. </span>Embedding Map Canvas</a><a class="headerlink" href="#embedding-map-canvas" title="Permalink to this headline"></a></h2>
<p>Map canvas is a widget like any other Qt widget, so using it is as simple as
creating and showing it.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">canvas</span> <span class="o">=</span> <span class="n">QgsMapCanvas</span><span class="p">()</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This produces a standalone window with map canvas. It can be also embedded into
an existing widget or window. When using <code class="file docutils literal notranslate"><span class="pre">.ui</span></code> files and Qt Designer, place a
<code class="docutils literal notranslate"><span class="pre">QWidget</span></code> on the form and promote it to a new class: set <code class="docutils literal notranslate"><span class="pre">QgsMapCanvas</span></code> as
class name and set <code class="docutils literal notranslate"><span class="pre">qgis.gui</span></code> as header file. The <code class="docutils literal notranslate"><span class="pre">pyuic5</span></code> utility will
take care of it. This is a very convenient way of embedding the canvas. The
other possibility is to manually write the code to construct map canvas and
other widgets (as children of a main window or dialog) and create a layout.</p>
<p>By default, map canvas has black background and does not use anti-aliasing. To
set white background and enable anti-aliasing for smooth rendering</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">canvas</span><span class="o">.</span><span class="n">setCanvasColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
<span class="n">canvas</span><span class="o">.</span><span class="n">enableAntiAliasing</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>(In case you are wondering, <code class="docutils literal notranslate"><span class="pre">Qt</span></code> comes from <code class="docutils literal notranslate"><span class="pre">PyQt.QtCore</span></code> module and
<code class="docutils literal notranslate"><span class="pre">Qt.white</span></code> is one of the predefined <code class="docutils literal notranslate"><span class="pre">QColor</span></code> instances.)</p>
<p>Now it is time to add some map layers. We will first open a layer and add it to
the current project. Then we will set the canvas extent and set the list of
layers for the canvas.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="s1">&#39;testdata/airports.shp&#39;</span><span class="p">,</span> <span class="s2">&quot;Airports layer&quot;</span><span class="p">,</span> <span class="s2">&quot;ogr&quot;</span><span class="p">)</span>
<span class="linenos"> 2</span><span class="k">if</span> <span class="ow">not</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
<span class="linenos"> 3</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Layer failed to load!&quot;</span><span class="p">)</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1"># add layer to the registry</span>
<span class="linenos"> 6</span><span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">vlayer</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># set extent to the extent of our layer</span>
<span class="linenos"> 9</span><span class="n">canvas</span><span class="o">.</span><span class="n">setExtent</span><span class="p">(</span><span class="n">vlayer</span><span class="o">.</span><span class="n">extent</span><span class="p">())</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1"># set the map canvas layer set</span>
<span class="linenos">12</span><span class="n">canvas</span><span class="o">.</span><span class="n">setLayers</span><span class="p">([</span><span class="n">vlayer</span><span class="p">])</span>
</pre></div>
</div>
<p>After executing these commands, the canvas should show the layer you have
loaded.</p>
</section>
<section id="rubber-bands-and-vertex-markers">
<span id="index-3"></span><h2><a class="toc-backref" href="#id2"><span class="section-number">9.2. </span>Rubber Bands and Vertex Markers</a><a class="headerlink" href="#rubber-bands-and-vertex-markers" title="Permalink to this headline"></a></h2>
<p>To show some additional data on top of the map in canvas, use map canvas items.
It is possible to create custom canvas item classes (covered below), however
there are two useful canvas item classes for convenience:
<a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsRubberBand.html#qgis.gui.QgsRubberBand" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRubberBand</span></code></a> for drawing polylines or polygons, and
<a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsVertexMarker.html#qgis.gui.QgsVertexMarker" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVertexMarker</span></code></a> for drawing points. They both work with map
coordinates, so the shape is moved/scaled automatically when the canvas is
being panned or zoomed.</p>
<p>To show a polyline:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># False = not a polygon</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="n">QgsPoint</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">45</span><span class="p">)]</span>
<span class="n">r</span><span class="o">.</span><span class="n">setToGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolyline</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>To show a polygon</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># True = a polygon</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[[</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">35</span><span class="p">)]]</span>
<span class="n">r</span><span class="o">.</span><span class="n">setToGeometry</span><span class="p">(</span><span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPolygonXY</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that points for polygon is not a plain list: in fact, it is a list of
rings containing linear rings of the polygon: first ring is the outer border,
further (optional) rings correspond to holes in the polygon.</p>
<p>Rubber bands allow some customization, namely to change their color and line
width</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
<span class="n">r</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>The canvas items are bound to the canvas scene. To temporarily hide them (and
show them again), use the <code class="xref py py-func docutils literal notranslate"><span class="pre">hide()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">show()</span></code> combo. To completely remove
the item, you have to remove it from the scene of the canvas</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">canvas</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">removeItem</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<p>(in C++ it’s possible to just delete the item, however in Python <code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">r</span></code>
would just delete the reference and the object will still exist as it is owned
by the canvas)</p>
<p>Rubber band can be also used for drawing points, but the
<a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsVertexMarker.html#qgis.gui.QgsVertexMarker" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsVertexMarker</span></code></a> class is better suited for this
(<a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsRubberBand.html#qgis.gui.QgsRubberBand" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsRubberBand</span></code></a> would only draw a rectangle around the desired point).</p>
<p>You can use the vertex marker like this:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">QgsVertexMarker</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">setCenter</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
</pre></div>
</div>
<p>This will draw a red cross on position <strong>[10,45]</strong>. It is possible to customize the
icon type, size, color and pen width</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">m</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">setIconType</span><span class="p">(</span><span class="n">QgsVertexMarker</span><span class="o">.</span><span class="n">ICON_BOX</span><span class="p">)</span> <span class="c1"># or ICON_CROSS, ICON_X</span>
<span class="n">m</span><span class="o">.</span><span class="n">setPenWidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>For temporary hiding of vertex markers and removing them from canvas, use the same methods
as for rubber bands.</p>
</section>
<section id="using-map-tools-with-canvas">
<span id="index-4"></span><h2><a class="toc-backref" href="#id3"><span class="section-number">9.3. </span>Using Map Tools with Canvas</a><a class="headerlink" href="#using-map-tools-with-canvas" title="Permalink to this headline"></a></h2>
<p>The following example constructs a window that contains a map canvas and basic
map tools for map panning and zooming. Actions are created for activation of
each tool: panning is done with <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapToolPan.html#qgis.gui.QgsMapToolPan" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapToolPan</span></code></a>, zooming in/out with a
pair of <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapToolZoom.html#qgis.gui.QgsMapToolZoom" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapToolZoom</span></code></a> instances. The actions are set as checkable and
later assigned to the tools to allow automatic handling of checked/unchecked
state of the actions – when a map tool gets activated, its action is marked as
selected and the action of the previous map tool is deselected. The map tools
are activated using <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas.setMapTool" title="(in QGIS Python API vmaster)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setMapTool()</span></code></a> method.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtWidgets</span> <span class="kn">import</span> <span class="n">QAction</span><span class="p">,</span> <span class="n">QMainWindow</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">class</span> <span class="nc">MyWnd</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layer</span><span class="p">):</span>
<span class="linenos"> 7</span>        <span class="n">QMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">QgsMapCanvas</span><span class="p">()</span>
<span class="linenos">10</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setCanvasColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setExtent</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">extent</span><span class="p">())</span>
<span class="linenos">13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setLayers</span><span class="p">([</span><span class="n">layer</span><span class="p">])</span>
<span class="linenos">14</span>
<span class="linenos">15</span>        <span class="bp">self</span><span class="o">.</span><span class="n">setCentralWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
<span class="linenos">16</span>
<span class="linenos">17</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomIn</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Zoom in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="linenos">18</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomOut</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Zoom out&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="linenos">19</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionPan</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Pan&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomIn</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">22</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomOut</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionPan</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomIn</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomIn</span><span class="p">)</span>
<span class="linenos">26</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionZoomOut</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zoomOut</span><span class="p">)</span>
<span class="linenos">27</span>        <span class="bp">self</span><span class="o">.</span><span class="n">actionPan</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pan</span><span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="s2">&quot;Canvas actions&quot;</span><span class="p">)</span>
<span class="linenos">30</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionZoomIn</span><span class="p">)</span>
<span class="linenos">31</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionZoomOut</span><span class="p">)</span>
<span class="linenos">32</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionPan</span><span class="p">)</span>
<span class="linenos">33</span>
<span class="linenos">34</span>        <span class="c1"># create the map tools</span>
<span class="linenos">35</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolPan</span> <span class="o">=</span> <span class="n">QgsMapToolPan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
<span class="linenos">36</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolPan</span><span class="o">.</span><span class="n">setAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionPan</span><span class="p">)</span>
<span class="linenos">37</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolZoomIn</span> <span class="o">=</span> <span class="n">QgsMapToolZoom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="c1"># false = in</span>
<span class="linenos">38</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolZoomIn</span><span class="o">.</span><span class="n">setAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionZoomIn</span><span class="p">)</span>
<span class="linenos">39</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolZoomOut</span> <span class="o">=</span> <span class="n">QgsMapToolZoom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># true = out</span>
<span class="linenos">40</span>        <span class="bp">self</span><span class="o">.</span><span class="n">toolZoomOut</span><span class="o">.</span><span class="n">setAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionZoomOut</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span>        <span class="bp">self</span><span class="o">.</span><span class="n">pan</span><span class="p">()</span>
<span class="linenos">43</span>
<span class="linenos">44</span>    <span class="k">def</span> <span class="nf">zoomIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">45</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolZoomIn</span><span class="p">)</span>
<span class="linenos">46</span>
<span class="linenos">47</span>    <span class="k">def</span> <span class="nf">zoomOut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">48</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolZoomOut</span><span class="p">)</span>
<span class="linenos">49</span>
<span class="linenos">50</span>    <span class="k">def</span> <span class="nf">pan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">51</span>        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolPan</span><span class="p">)</span>
</pre></div>
</div>
<p>You can try the above code in the Python console editor. To invoke the canvas window,
add the following lines to instantiate the <code class="docutils literal notranslate"><span class="pre">MyWnd</span></code> class. They will render the currently
selected layer on the newly created canvas</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="n">MyWnd</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">())</span>
<span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<section id="select-a-feature-using-qgsmaptoolidentifyfeature">
<h3><a class="toc-backref" href="#id4"><span class="section-number">9.3.1. </span>Select a feature using QgsMapToolIdentifyFeature</a><a class="headerlink" href="#select-a-feature-using-qgsmaptoolidentifyfeature" title="Permalink to this headline"></a></h3>
<p>You can use the map tool <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapToolIdentifyFeature.html#qgis.gui.QgsMapToolIdentifyFeature" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapToolIdentifyFeature</span></code></a>
for asking to the user to select a feature that will be sent to a callback function.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">feature</span><span class="p">):</span>
<span class="linenos"> 2</span>  <span class="sd">&quot;&quot;&quot;Code called when the feature is selected by the user&quot;&quot;&quot;</span>
<span class="linenos"> 3</span>  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You clicked on feature </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">id</span><span class="p">()))</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span>
<span class="linenos"> 6</span><span class="n">feature_identifier</span> <span class="o">=</span> <span class="n">QgsMapToolIdentifyFeature</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># indicates the layer on which the selection will be done</span>
<span class="linenos"> 9</span><span class="n">feature_identifier</span><span class="o">.</span><span class="n">setLayer</span><span class="p">(</span><span class="n">vlayer</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1"># use the callback as a slot triggered when the user identifies a feature</span>
<span class="linenos">12</span><span class="n">feature_identifier</span><span class="o">.</span><span class="n">featureIdentified</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="c1"># activation of the map tool</span>
<span class="linenos">15</span><span class="n">canvas</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="n">feature_identifier</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="writing-custom-map-tools">
<span id="index-5"></span><h2><a class="toc-backref" href="#id5"><span class="section-number">9.4. </span>Writing Custom Map Tools</a><a class="headerlink" href="#writing-custom-map-tools" title="Permalink to this headline"></a></h2>
<p>You can write your custom tools, to implement a custom behavior to actions
performed by users on the canvas.</p>
<p>Map tools should inherit from the <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapTool.html#qgis.gui.QgsMapTool" title="(in QGIS Python API vmaster)"><code class="xref py py-class docutils literal notranslate"><span class="pre">QgsMapTool</span></code></a>,
class or any derived class, and selected as active tools in the canvas using
the <a class="reference external" href="https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html#qgis.gui.QgsMapCanvas.setMapTool" title="(in QGIS Python API vmaster)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setMapTool()</span></code></a>
method as we have already seen.</p>
<p>Here is an example of a map tool that allows to define a rectangular extent by
clicking and dragging on the canvas. When the rectangle is defined, it prints
its boundary coordinates in the console. It uses the rubber band elements
described before to show the selected rectangle as it is being defined.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">RectangleMapTool</span><span class="p">(</span><span class="n">QgsMapToolEmitPoint</span><span class="p">):</span>
<span class="linenos"> 2</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
<span class="linenos"> 3</span>    <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
<span class="linenos"> 4</span>    <span class="n">QgsMapToolEmitPoint</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
<span class="linenos"> 5</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span> <span class="o">=</span> <span class="n">QgsRubberBand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 6</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
<span class="linenos"> 7</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 8</span>    <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>  <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">11</span>    <span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">12</span>    <span class="bp">self</span><span class="o">.</span><span class="n">isEmittingPoint</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">13</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>  <span class="k">def</span> <span class="nf">canvasPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="linenos">16</span>    <span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toMapCoordinates</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
<span class="linenos">17</span>    <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span>
<span class="linenos">18</span>    <span class="bp">self</span><span class="o">.</span><span class="n">isEmittingPoint</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos">19</span>    <span class="bp">self</span><span class="o">.</span><span class="n">showRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>  <span class="k">def</span> <span class="nf">canvasReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="linenos">22</span>    <span class="bp">self</span><span class="o">.</span><span class="n">isEmittingPoint</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">23</span>    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rectangle</span><span class="p">()</span>
<span class="linenos">24</span>    <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">25</span>      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rectangle:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">xMinimum</span><span class="p">(),</span>
<span class="linenos">26</span>            <span class="n">r</span><span class="o">.</span><span class="n">yMinimum</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">xMaximum</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">yMaximum</span><span class="p">()</span>
<span class="linenos">27</span>           <span class="p">)</span>
<span class="linenos">28</span>
<span class="linenos">29</span>  <span class="k">def</span> <span class="nf">canvasMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
<span class="linenos">30</span>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isEmittingPoint</span><span class="p">:</span>
<span class="linenos">31</span>      <span class="k">return</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toMapCoordinates</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
<span class="linenos">34</span>    <span class="bp">self</span><span class="o">.</span><span class="n">showRect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span><span class="p">)</span>
<span class="linenos">35</span>
<span class="linenos">36</span>  <span class="k">def</span> <span class="nf">showRect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startPoint</span><span class="p">,</span> <span class="n">endPoint</span><span class="p">):</span>
<span class="linenos">37</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">QGis</span><span class="o">.</span><span class="n">Polygon</span><span class="p">)</span>
<span class="linenos">38</span>    <span class="k">if</span> <span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">==</span> <span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="ow">or</span> <span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">==</span> <span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">():</span>
<span class="linenos">39</span>      <span class="k">return</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="n">point1</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
<span class="linenos">42</span>    <span class="n">point2</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
<span class="linenos">43</span>    <span class="n">point3</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
<span class="linenos">44</span>    <span class="n">point4</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">())</span>
<span class="linenos">45</span>
<span class="linenos">46</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">47</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">point2</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">48</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">point3</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<span class="linenos">49</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">point4</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>    <span class="c1"># true to update canvas</span>
<span class="linenos">50</span>    <span class="bp">self</span><span class="o">.</span><span class="n">rubberBand</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="linenos">51</span>
<span class="linenos">52</span>  <span class="k">def</span> <span class="nf">rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">53</span>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">54</span>      <span class="k">return</span> <span class="kc">None</span>
<span class="linenos">55</span>    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="ow">or</span> \
<span class="linenos">56</span>          <span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span><span class="o">.</span><span class="n">y</span><span class="p">()):</span>
<span class="linenos">57</span>      <span class="k">return</span> <span class="kc">None</span>
<span class="linenos">58</span>
<span class="linenos">59</span>      <span class="k">return</span> <span class="n">QgsRectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPoint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPoint</span><span class="p">)</span>
<span class="linenos">60</span>
<span class="linenos">61</span>  <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">62</span>    <span class="n">QgsMapTool</span><span class="o">.</span><span class="n">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos">63</span>    <span class="bp">self</span><span class="o">.</span><span class="n">deactivated</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="writing-custom-map-canvas-items">
<span id="index-6"></span><h2><a class="toc-backref" href="#id6"><span class="section-number">9.5. </span>Writing Custom Map Canvas Items</a><a class="headerlink" href="#writing-custom-map-canvas-items" title="Permalink to this headline"></a></h2>
<p>Here is an example of a custom canvas item that draws a circle:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">class</span> <span class="nc">CircleCanvasItem</span><span class="p">(</span><span class="n">QgsMapCanvasItem</span><span class="p">):</span>
<span class="linenos"> 2</span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
<span class="linenos"> 3</span>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
<span class="linenos"> 4</span>    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 5</span>    <span class="bp">self</span><span class="o">.</span><span class="n">size</span>   <span class="o">=</span> <span class="mi">100</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>  <span class="k">def</span> <span class="nf">setCenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">):</span>
<span class="linenos"> 8</span>    <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">center</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>  <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">11</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
<span class="linenos">12</span>
<span class="linenos">13</span>  <span class="k">def</span> <span class="nf">setSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="linenos">14</span>    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
<span class="linenos">15</span>
<span class="linenos">16</span>  <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">17</span>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">18</span>
<span class="linenos">19</span>  <span class="k">def</span> <span class="nf">boundingRect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">20</span>    <span class="k">return</span> <span class="n">QRectF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
<span class="linenos">21</span>      <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
<span class="linenos">22</span>      <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
<span class="linenos">23</span>      <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>  <span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
<span class="linenos">26</span>    <span class="n">path</span> <span class="o">=</span> <span class="n">QPainterPath</span><span class="p">()</span>
<span class="linenos">27</span>    <span class="n">path</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">());</span>
<span class="linenos">28</span>    <span class="n">path</span><span class="o">.</span><span class="n">arcTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">painter</span><span class="o">.</span><span class="n">fillPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s2">&quot;red&quot;</span><span class="p">))</span>
<span class="linenos">30</span>
<span class="linenos">31</span>
<span class="linenos">32</span><span class="c1"># Using the custom item:</span>
<span class="linenos">33</span><span class="n">item</span> <span class="o">=</span> <span class="n">CircleCanvasItem</span><span class="p">(</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">())</span>
<span class="linenos">34</span><span class="n">item</span><span class="o">.</span><span class="n">setCenter</span><span class="p">(</span><span class="n">QgsPointXY</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
<span class="linenos">35</span><span class="n">item</span><span class="o">.</span><span class="n">setSize</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="crs.html" class="btn btn-neutral float-left" title="8. Projections Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="composer.html" class="btn btn-neutral float-right" title="10. Map Rendering and Printing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">Last updated on Oct 24, 2021 11:42.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages
example of expected format: .../locale-en-lc-messages-docs-gentle-gis-introduction-data-capture-po--release-3-16 
for the page ...3.16/docs/gentle_gis_introduction/data_capture.html in release_3.16 branch-->
<!--Make sure that mismatching languages codes are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: testing
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/canvas.html">en</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/pyqgis_developer_cookbook/canvas.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/en/docs/pyqgis_developer_cookbook/canvas.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/canvas.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/canvas.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/en/docs/pyqgis_developer_cookbook/canvas.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/en/docs/pyqgis_developer_cookbook/canvas.html">2.18</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.14/en/docs/pyqgis_developer_cookbook/canvas.html">2.14</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.8/en/docs/pyqgis_developer_cookbook/canvas.html">2.8</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.6/en/docs/pyqgis_developer_cookbook/canvas.html">2.6</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.2/en/docs/pyqgis_developer_cookbook/canvas.html">2.2</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.0/en/docs/pyqgis_developer_cookbook/canvas.html">2.0</a></dd>
        
          <dd><a href="https://docs.qgis.org/1.8/en/docs/pyqgis_developer_cookbook/canvas.html">1.8</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/testing/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/testing/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/pyqgis_developer_cookbook/canvas.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/en" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/master" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/master" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>