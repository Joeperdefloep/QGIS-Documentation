<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>12.1. Expressions &mdash; QGIS Documentation  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/qgis_docs.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/qgis_topbar.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/user_manual/expressions/expression.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="12.2. List of functions" href="functions_list.html" />
    <link rel="prev" title="12. Level up with Expressions" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
    <div class="row isTesting">
     This documentation is a work in progress. For the Long Term Release and translations, please visit the <a href="https://docs.qgis.org/latest/en/docs/user_manual/expressions/expression.html">latest version</a>.
    </div>
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   
            <a href="../../index.html" class="icon icon-home"> QGIS Documentation
            <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                testing
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../../genindex.html">Index</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">For Wageningen Students</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../land_degradation_development/index.html">Land Degradation and Development</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Users</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">QGIS Desktop User Guide/Manual (QGIS Testing)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../preamble/preamble.html">1. Preamble</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/foreword.html">2. Foreword</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/conventions.html">3. Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/features.html">4. Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/getting_started.html">5. Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/project_files.html">6. Working with Project Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_gui.html">7. QGIS GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/browser.html">8. The Browser panel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_configuration.html">9. QGIS Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_projections/working_with_projections.html">10. Working with Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/general_tools.html">11. General Tools</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">12. Level up with Expressions</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">12.1. Expressions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-expression-string-builder">12.1.1. The Expression string builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-editor">12.1.2. Function Editor</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="functions_list.html">12.2. List of functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../style_library/index.html">13. The Style Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../managing_data_source/index.html">14. Managing Data Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_vector/index.html">15. Working with Vector Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_raster/index.html">16. Working with Raster Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_mesh/mesh_properties.html">17. Working with Mesh Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_vector_tiles/vector_tiles_properties.html">18. Working with Vector Tiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../print_composer/index.html">19. Laying out the maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_ogc/ogc_client_support.html">20. Working with OGC / ISO protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_gps/index.html">21. Working with GPS Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth_system/index.html">22. Authentication System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../grass_integration/grass_integration.html">23. GRASS GIS Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing/index.html">24. QGIS processing framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_algs/index.html">25. Processing providers and algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html">26. Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/help_and_support.html">27. Help and Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../preamble/contributors.html">28. Contributors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/index.html">29. Appendices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../literature_web/literature_and_web_references.html">30. Literature and Web References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../server_manual/index.html">QGIS Server Guide/Manual (QGIS Testing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training_manual/index.html">Training Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gentle_gis_introduction/index.html">A Gentle Introduction to GIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Writers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_guidelines/index.html">Documentation Guidelines</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyqgis_developer_cookbook/index.html">PyQGIS Cookbook (QGIS Testing)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/index.html">Developers Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">QGIS User Guide</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">12. </span>Level up with Expressions</a> &raquo;</li>
      <li><span class="section-number">12.1. </span>Expressions</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/user_manual/expressions/expression.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="index.html" class="btn btn-neutral float-left" title="12. Level up with Expressions" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="functions_list.html" class="btn btn-neutral float-right" title="12.2. List of functions" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="expressions">
<span id="vector-expressions"></span><span id="index-0"></span><h1><span class="section-number">12.1. </span>Expressions<a class="headerlink" href="#expressions" title="Permalink to this headline"></a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#the-expression-string-builder" id="id5">The Expression string builder</a></p>
<ul>
<li><p><a class="reference internal" href="#the-interface" id="id6">The Interface</a></p></li>
<li><p><a class="reference internal" href="#writing-an-expression" id="id7">Writing an expression</a></p></li>
<li><p><a class="reference internal" href="#some-use-cases-of-expressions" id="id8">Some use cases of expressions</a></p></li>
<li><p><a class="reference internal" href="#saving-expressions" id="id9">Saving Expressions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#function-editor" id="id10">Function Editor</a></p></li>
</ul>
</div>
<p>Based on layer data and prebuilt or user defined functions, <strong>Expressions</strong>
offer a powerful way to manipulate attribute value, geometry and variables
in order to dynamically change the geometry style, the content or position
of the label, the value for diagram, the height of a layout item,
select some features, create virtual field, …</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A list of the default functions and variables for writing expressions
can be found at <a class="reference internal" href="functions_list.html#functions-list"><span class="std std-ref">List of functions</span></a>, with detailed information and examples.</p>
</div>
<section id="the-expression-string-builder">
<span id="expression-builder"></span><h2><a class="toc-backref" href="#id5"><span class="section-number">12.1.1. </span>The Expression string builder</a><a class="headerlink" href="#the-expression-string-builder" title="Permalink to this headline"></a></h2>
<p>Main dialog to build expressions, the <span class="guilabel">Expression string builder</span>
is available from many parts in QGIS and, can particularly be accessed when:</p>
<ul class="simple">
<li><p>clicking the <a class="reference internal" href="../../../_images/mIconExpression.png"><img alt="expression" src="../../../_images/mIconExpression.png" style="width: 1.5em;" /></a> button;</p></li>
<li><p><a class="reference internal" href="../introduction/general_tools.html#sec-selection"><span class="std std-ref">selecting features</span></a> with the <a class="reference internal" href="../../../_images/mIconExpressionSelect.png"><img alt="expressionSelect" src="../../../_images/mIconExpressionSelect.png" style="width: 1.5em;" /></a>
<sup>Select By Expression…</sup> tool;</p></li>
<li><p><a class="reference internal" href="../working_with_vector/attribute_table.html#calculate-fields-values"><span class="std std-ref">editing attributes</span></a> with e.g. the
<a class="reference internal" href="../../../_images/mActionCalculateField.png"><img alt="calculateField" src="../../../_images/mActionCalculateField.png" style="width: 1.5em;" /></a> <sup>Field calculator</sup> tool;</p></li>
<li><p>manipulating symbology, label or layout item parameters with the <a class="reference internal" href="../../../_images/mIconDataDefine.png"><img alt="dataDefined" src="../../../_images/mIconDataDefine.png" style="width: 1.5em;" /></a>
<sup>Data defined override</sup> tool (see <a class="reference internal" href="../introduction/general_tools.html#data-defined"><span class="std std-ref">Data defined override setup</span></a>);</p></li>
<li><p>building a <a class="reference internal" href="../style_library/symbol_selector.html#geometry-generator-symbol"><span class="std std-ref">geometry generator</span></a> symbol layer;</p></li>
<li><p>doing some <a class="reference internal" href="../processing/index.html#label-processing"><span class="std std-ref">geoprocessing</span></a>.</p></li>
</ul>
<p>The Expression builder dialog offers access to the:</p>
<ul class="simple">
<li><p><a class="reference internal" href="functions_list.html#functions-list"><span class="std std-ref">Expression tab</span></a> which, thanks to a list of predefined
functions, helps to write and check the expression to use;</p></li>
<li><p><a class="reference internal" href="#function-editor"><span class="std std-ref">Function Editor tab</span></a> which helps to extend the list of
functions by creating custom ones.</p></li>
</ul>
<section id="the-interface">
<h3><a class="toc-backref" href="#id6"><span class="section-number">12.1.1.1. </span>The Interface</a><a class="headerlink" href="#the-interface" title="Permalink to this headline"></a></h3>
<p>The <span class="guilabel">Expression</span> tab provides the main interface to write expressions
using functions, layer fields and values. It contains the following widgets:</p>
<figure class="align-center" id="id2">
<span id="figure-expression-tab"></span><a class="reference internal image-reference" href="../../../_images/function_list.png"><img alt="../../../_images/function_list.png" src="../../../_images/function_list.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12.1 </span><span class="caption-text">The Expression tab</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>An expression editor area for typing or pasting expressions. Autocompletion is
available to speed expression writing:</p>
<ul class="simple">
<li><p>Corresponding variables, function names and field names to the input text
are shown below: use the <kbd class="kbd docutils literal notranslate">Up</kbd> and <kbd class="kbd docutils literal notranslate">Down</kbd> arrows to browse the
items and press <kbd class="kbd docutils literal notranslate">Tab</kbd> to insert in the expression or simply click
on the wished item.</p></li>
<li><p>Function parameters are shown while filling them.</p></li>
</ul>
<p>QGIS also checks the expression rightness and highlights all the errors using:</p>
<ul class="simple">
<li><p><em>Underline</em>: for unknown functions, wrong or invalid arguments;</p></li>
<li><p><em>Marker</em>: for every other error (eg, missing parenthesis, unexpected
character) at a single location.</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Document your expression with comments</strong></p>
<p>When using complex expression, it is good practice to add
text either as a multiline comment or inline comments to help you remember.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*
Labels each region with its highest (in altitude) airport(s)
and altitude, eg &#39;AMBLER : 264m&#39; for the &#39;Northwest Artic&#39; region
*/
with_variable(
  &#39;airport_alti&#39;, -- stores the highest altitude of the region
  aggregate(
    &#39;airports&#39;,
    &#39;max&#39;,
    &quot;ELEV&quot;, -- the field containing the altitude
    -- and limit the airports to the region they are within
    filter := within( $geometry, geometry( @parent ) )
  ),
    aggregate( -- finds airports at the same altitude in the region
      &#39;airports&#39;,
      &#39;concatenate&#39;,
      &quot;NAME&quot;,
      filter := within( $geometry, geometry( @parent ) )
        and &quot;ELEV&quot; = @airport_alti
    )
    || &#39; : &#39; || @airport_alti || &#39;m&#39;
    -- using || allows regions without airports to be skipped
)
</pre></div>
</div>
</div>
</li>
<li><p>Above the expression editor, a set of tools helps you:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mActionFileNew.png"><img alt="fileNew" src="../../../_images/mActionFileNew.png" style="width: 1.5em;" /></a><sup>Clear the expression editor</sup></p></li>
<li><p>create and manage <a class="reference internal" href="#user-expressions-functions"><span class="std std-ref">user expressions</span></a></p></li>
</ul>
</li>
<li><p>Under the expression editor, you find:</p>
<ul>
<li><p>a set of basic operators to help you build the expression</p></li>
<li><p>an indication of the expected format of output when you are data-defining
feature properties</p></li>
<li><p>a live <span class="guilabel">Output preview</span> of the expression, evaluated
on the first feature of the Layer by default.
You can browse and evaluate other features of the layer using the
<span class="guilabel">Feature</span> combobox (the values are taken from the
<a class="reference internal" href="../working_with_vector/vector_properties.html#maptips"><span class="std std-ref">display name</span></a> property of the layer).</p>
<p>In case of error, it indicates it and you can access the details with the
provided hyperlink.</p>
</li>
</ul>
</li>
<li><p>A function selector displays the list of functions, variables, fields…
organized in groups. A search box is available to filter the list and quickly
find a particular function or field.
Double-clicking an item adds it to the expression editor.</p></li>
<li><p>A help panel displays help for each selected item in the function selector.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Press <kbd class="kbd compound docutils literal notranslate"><kbd class="kbd docutils literal notranslate">Ctrl</kbd>+<kbd class="kbd docutils literal notranslate">Click</kbd></kbd> when hovering a function name in an expression to
automatically display its help in the dialog.</p>
</div>
<p>A field’s values widget shown when a field is selected in the function selector
helps to fetch features attributes:</p>
<ul>
<li><p>Look for a particular field value</p></li>
<li><p>Display the list of <span class="guilabel">All Unique</span> or <span class="guilabel">10 Samples</span> values.
Also available from right-click.</p>
<p>When the field is mapped with another layer or a set of values, i.e. if the
<a class="reference internal" href="../working_with_vector/vector_properties.html#edit-widgets"><span class="std std-ref">field widget</span></a> is of <em>RelationReference</em>, <em>ValueRelation</em>
or <em>ValueMap</em> type, it’s possible to list all the values of the mapped field
(from the referenced layer, table or list). Moreover, you can filter this
list to <a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">Only show values in use</span> in the current field.</p>
</li>
</ul>
<p>Double-clicking a field value in the widget adds it to the expression editor.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The right panel, showing functions help or field values, can be
collapsed (invisible) in the dialog. Press the <span class="guilabel">Show Values</span>
or <span class="guilabel">Show Help</span> button to get it back.</p>
</div>
</li>
</ul>
</section>
<section id="writing-an-expression">
<h3><a class="toc-backref" href="#id7"><span class="section-number">12.1.1.2. </span>Writing an expression</a><a class="headerlink" href="#writing-an-expression" title="Permalink to this headline"></a></h3>
<p>QGIS expressions are used to select features or set values.
Writing an expression in QGIS follows some rules:</p>
<ol class="arabic">
<li><p><strong>The dialog defines the context</strong>: if you are used to SQL, you probably
know queries of the type <em>select features from layer where condition</em>
or <em>update layer set field = new_value where condition</em>.
A QGIS expression also needs all these information but the tool you use
to open the expression builder dialog provides parts of them.
For example, giving a layer (building) with a field (height):</p>
<ul class="simple">
<li><p>pressing the <a class="reference internal" href="../../../_images/mIconExpressionSelect.png"><img alt="expressionSelect" src="../../../_images/mIconExpressionSelect.png" style="width: 1.5em;" /></a><sup>Select by expression</sup> tool means that
you want to “select features from buildings”. The <strong>condition</strong> is the
only information you need to provide in the expression text widget,
e.g. type <code class="docutils literal notranslate"><span class="pre">&quot;height&quot;</span> <span class="pre">&gt;</span> <span class="pre">20</span></code> to select buildings that are higher than 20.</p></li>
<li><p>with this selection made, pressing the <a class="reference internal" href="../../../_images/mActionCalculateField.png"><img alt="calculateField" src="../../../_images/mActionCalculateField.png" style="width: 1.5em;" /></a> <sup>Field calculator</sup>
button and choosing “height” as <span class="guilabel">Update existing field</span>, you already
provide the command “update buildings set height = ??? where height &gt; 20”.
The only remaining bits you have to provide in this case is the <strong>new value</strong>,
e.g. just enter <code class="docutils literal notranslate"><span class="pre">50</span></code> to set the height of the previously selected buildings.</p></li>
</ul>
</li>
<li><p><strong>Pay attention to quotes</strong>: single quotes return a literal, so a
text placed between single quotes (<code class="docutils literal notranslate"><span class="pre">'145'</span></code>) is interpreted as a string.
Double quotes will give you the value of that text so use them for fields
(<code class="docutils literal notranslate"><span class="pre">&quot;myfield&quot;</span></code>). Fields can also be used without quotes (<code class="docutils literal notranslate"><span class="pre">myfield</span></code>).
No quotes for numbers (<code class="docutils literal notranslate"><span class="pre">3.16</span></code>).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions normally take as argument a string for field name.
Do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attribute</span><span class="p">(</span> <span class="nd">@atlas_feature</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span> <span class="p">)</span> <span class="o">--</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">value</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="s2">&quot;height&quot;</span> <span class="n">attribute</span> <span class="n">of</span> <span class="n">the</span> <span class="n">current</span> <span class="n">atlas</span> <span class="n">feature</span>
</pre></div>
</div>
<p>And not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attribute</span><span class="p">(</span> <span class="nd">@atlas_feature</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span> <span class="p">)</span> <span class="o">--</span> <span class="n">fetches</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">attribute</span> <span class="n">named</span> <span class="s2">&quot;height&quot;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="mi">100</span><span class="p">),</span> <span class="ow">and</span> <span class="n">use</span> <span class="n">that</span> <span class="n">value</span> <span class="k">as</span> <span class="n">a</span> <span class="n">field</span>
                                      <span class="o">--</span> <span class="kn">from</span> <span class="nn">which</span> <span class="n">to</span> <span class="k">return</span> <span class="n">the</span> <span class="n">atlas</span> <span class="n">feature</span> <span class="n">value</span><span class="o">.</span> <span class="n">Probably</span> <span class="n">wrong</span> <span class="k">as</span> <span class="n">a</span> <span class="n">field</span> <span class="n">named</span> <span class="s2">&quot;100&quot;</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">exist</span><span class="o">.</span>
</pre></div>
</div>
</div>
</li>
</ol>
<div class="admonition tip" id="index-1">
<p class="admonition-title">Tip</p>
<p><strong>Use named parameters to ease expression reading</strong></p>
<p>Some functions require many parameters to be set. The expression engine supports the
use of named parameters. This means that instead of writing the cryptic expression
<code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">9)</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">min:=1,</span> <span class="pre">value:=2,</span> <span class="pre">max:=9)</span></code>. This also allows
arguments to be switched, e.g. <code class="docutils literal notranslate"><span class="pre">clamp(</span> <span class="pre">value:=2,</span> <span class="pre">max:=9,</span> <span class="pre">min:=1)</span></code>. Using named parameters
helps clarify what the arguments for an expression function refer to, which is helpful
when you are trying to interpret an expression later!</p>
</div>
</section>
<section id="some-use-cases-of-expressions">
<h3><a class="toc-backref" href="#id8"><span class="section-number">12.1.1.3. </span>Some use cases of expressions</a><a class="headerlink" href="#some-use-cases-of-expressions" title="Permalink to this headline"></a></h3>
<ul>
<li><p>From the Field Calculator, calculate a “pop_density” field using the existing “total_pop”
and “area_km2” fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;total_pop&quot;</span> <span class="o">/</span> <span class="s2">&quot;area_km2&quot;</span>
</pre></div>
</div>
</li>
<li><p>Label or categorize features based on their area:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CASE WHEN $area &gt; 10 000 THEN &#39;Larger&#39; ELSE &#39;Smaller&#39; END
</pre></div>
</div>
</li>
<li><p>Update the field “density_level” with categories according to the “pop_density” values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CASE</span> <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="n">THEN</span> <span class="s1">&#39;Low population density&#39;</span>
     <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="ow">and</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&lt;</span> <span class="mi">150</span> <span class="n">THEN</span> <span class="s1">&#39;Medium population density&#39;</span>
     <span class="n">WHEN</span> <span class="s2">&quot;pop_density&quot;</span> <span class="o">&gt;=</span> <span class="mi">150</span> <span class="n">THEN</span> <span class="s1">&#39;High population density&#39;</span>
<span class="n">END</span>
</pre></div>
</div>
</li>
<li><p>Apply a categorized style to all the features according to whether their average house
price is smaller or higher than 10000€ per square metre:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;price_m2&quot;</span> <span class="o">&gt;</span> <span class="mi">10000</span>
</pre></div>
</div>
</li>
<li><p>Using the “Select By Expression…” tool, select all the features representing
areas of “High population density” and whose average house price is higher than
10000€ per square metre:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;density_level&quot;</span> <span class="o">=</span> <span class="s1">&#39;High population density&#39;</span> <span class="ow">and</span> <span class="s2">&quot;price_m2&quot;</span> <span class="o">&gt;</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>The previous expression could also be used to define which features
to label or show on the map.</p>
</li>
<li><p>Create a different symbol (type) for the layer, using the geometry generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>point_on_surface( $geometry )
</pre></div>
</div>
</li>
<li><p>Given a point feature, generate a closed line (using <code class="docutils literal notranslate"><span class="pre">make_line</span></code>) around its
geometry:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>make_line(
  -- using an array of points placed around the original
  array_foreach(
    -- list of angles for placing the projected points (every 90°)
    array:=generate_series( 0, 360, 90 ),
    -- translate the point 20 units in the given direction (angle)
    expression:=project( $geometry, distance:=20, azimuth:=radians( @element ) )
  )
)
</pre></div>
</div>
</li>
<li><p>In a print layout label, display the name of the “airports” features that are
within the layout “Map 1” item:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>with_variable( &#39;extent&#39;,
               map_get( item_variables( &#39;Map 1&#39; ), &#39;map_extent&#39; ),
               aggregate( &#39;airports&#39;, &#39;concatenate&#39;, &quot;NAME&quot;,
                          intersects( $geometry, @extent ), &#39; ,&#39;
                        )
             )
</pre></div>
</div>
</li>
</ul>
</section>
<section id="saving-expressions">
<span id="user-expressions-functions"></span><span id="index-2"></span><h3><a class="toc-backref" href="#id9"><span class="section-number">12.1.1.4. </span>Saving Expressions</a><a class="headerlink" href="#saving-expressions" title="Permalink to this headline"></a></h3>
<p>Using the <a class="reference internal" href="../../../_images/mActionFileSave.png"><img alt="fileSave" src="../../../_images/mActionFileSave.png" style="width: 1.5em;" /></a> <sup>Add current expression to user expressions</sup> button
above the expression editor frame, you can save important expressions you want
to have quick access to. These are available from the <strong>User expressions</strong> group
in the middle panel.
They are saved under the user profile (<code class="file docutils literal notranslate"><span class="pre">&lt;userprofile&gt;/QGIS/QGIS3.ini</span></code>
file) and available in all expression dialogs inside all projects of the
current user profile.</p>
<p>A set of tools available above the expression editor frame helps you manage
the user expressions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mActionFileSave.png"><img alt="fileSave" src="../../../_images/mActionFileSave.png" style="width: 1.5em;" /></a><sup>Add the current expression to user expressions</sup>: store the
expression in the user profile. A label and a help text can be added for
easy identification.</p></li>
<li><p><a class="reference internal" href="../../../_images/symbologyEdit.png"><img alt="symbologyEdit" src="../../../_images/symbologyEdit.png" style="width: 1.5em;" /></a> <sup>Edit selected expression from user expressions</sup>,
as well as their help and label</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionDeleteSelected.png"><img alt="deleteSelected" src="../../../_images/mActionDeleteSelected.png" style="width: 1.5em;" /></a> <sup>Remove selected expression from user expressions</sup></p></li>
<li><p><a class="reference internal" href="../../../_images/mActionSharingImport.png"><img alt="sharingImport" src="../../../_images/mActionSharingImport.png" style="width: 1.5em;" /></a> <sup>Import user expressions</sup> from a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file
into the active user profile folder</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionSharingExport.png"><img alt="sharingExport" src="../../../_images/mActionSharingExport.png" style="width: 1.5em;" /></a> <sup>Export user expressions</sup> as a <code class="docutils literal notranslate"><span class="pre">.json</span></code> file;
all the user expressions in the user profile <code class="file docutils literal notranslate"><span class="pre">QGIS3.ini</span></code> file are
shared</p></li>
</ul>
</section>
</section>
<section id="function-editor">
<span id="index-3"></span><span id="id1"></span><h2><a class="toc-backref" href="#id10"><span class="section-number">12.1.2. </span>Function Editor</a><a class="headerlink" href="#function-editor" title="Permalink to this headline"></a></h2>
<p>With the <span class="guilabel">Function Editor</span> tab, you are able to write your own functions
in Python language. This provides a handy and comfortable way to address
particular needs that would not be covered by the predefined functions.</p>
<figure class="align-center" id="id3">
<span id="figure-expression-function"></span><img alt="../../../_images/function_editor.png" src="../../../_images/function_editor.png" />
<figcaption>
<p><span class="caption-number">Fig. 12.2 </span><span class="caption-text">The Function Editor tab</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>To create a new function:</p>
<ol class="arabic">
<li><p>Press the <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="signPlus" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <sup>New File</sup> button.</p></li>
<li><p>Enter a name to use in the form that pops up and press <span class="guilabel">OK</span>.</p>
<p>A new item of the name you provide is added in the left panel of the
<span class="guilabel">Function Editor</span> tab; this is a Python <code class="file docutils literal notranslate"><span class="pre">.py</span></code> file based on
QGIS template file and stored in the <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code> folder
under the active <a class="reference internal" href="../introduction/qgis_configuration.html#user-profiles"><span class="std std-ref">user profile</span></a> directory.</p>
</li>
<li><p>The right panel displays the content of the file: a python script template.
Update the code and its help according to your needs.</p></li>
<li><p>Press the <a class="reference internal" href="../../../_images/mActionStart.png"><img alt="start" src="../../../_images/mActionStart.png" style="width: 1.5em;" /></a> <span class="guilabel">Save and Load Functions</span> button.
The function you wrote is added to the functions tree in the <span class="guilabel">Expression</span>
tab, by default under the <code class="docutils literal notranslate"><span class="pre">Custom</span></code> group.</p></li>
<li><p>Enjoy your new function.</p></li>
<li><p>If the function requires improvements, enable the <span class="guilabel">Function Editor</span>
tab, do the changes and press again the <a class="reference internal" href="../../../_images/mActionStart.png"><img alt="start" src="../../../_images/mActionStart.png" style="width: 1.5em;" /></a> <span class="guilabel">Save and Load
Functions</span> button to make them available in the file, hence in any expression
tab.</p></li>
</ol>
<p>Custom Python functions are stored under the user profile directory, meaning that at
each QGIS startup, it will auto load all the functions defined with the current user
profile. Be aware that new functions are only saved in the <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code>
folder and not in the project file.
If you share a project that uses one of your custom functions you will need to also
share the <code class="file docutils literal notranslate"><span class="pre">.py</span></code> file in the <code class="file docutils literal notranslate"><span class="pre">/python/expressions</span></code> folder.</p>
<p>To delete a custom function:</p>
<ol class="arabic simple">
<li><p>Enable the <span class="guilabel">Function Editor</span> tab</p></li>
<li><p>Select the function in the list</p></li>
<li><p>Press the <a class="reference internal" href="../../../_images/symbologyRemove.png"><img alt="signMinus" src="../../../_images/symbologyRemove.png" style="width: 1.5em;" /></a> <sup>Remove selected function</sup>. The function is
removed from the list and the corresponding <code class="docutils literal notranslate"><span class="pre">.py</span></code> file deleted from
the user profile folder.</p></li>
</ol>
<p><strong>Example</strong></p>
<p>Here’s a short example on how to create your own <code class="docutils literal notranslate"><span class="pre">my_sum</span></code> function that
will operate with two values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@qgsfunction</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s1">&#39;Custom&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_sum</span><span class="p">(</span><span class="n">value1</span><span class="p">,</span> <span class="n">value2</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the sum of the two parameters value1 and value2.</span>
<span class="sd">    &lt;h2&gt;Example usage:&lt;/h2&gt;</span>
<span class="sd">    &lt;ul&gt;</span>
<span class="sd">      &lt;li&gt;my_sum(5, 8) -&gt; 13&lt;/li&gt;</span>
<span class="sd">      &lt;li&gt;my_sum(&quot;field1&quot;, &quot;field2&quot;) -&gt; 42&lt;/li&gt;</span>
<span class="sd">    &lt;/ul&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>
</pre></div>
</div>
<p>When using the <code class="docutils literal notranslate"><span class="pre">args='auto'</span></code> function argument the number of function
arguments required will be calculated by the number of arguments the function
has been defined with in Python (minus 2 - <code class="docutils literal notranslate"><span class="pre">feature</span></code>, and <code class="docutils literal notranslate"><span class="pre">parent</span></code>).
The <code class="docutils literal notranslate"><span class="pre">group='Custom'</span></code> argument indicates the group in which the function
should be listed in the Expression dialog.</p>
<p>It is also possible to add keywords arguments like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">usesgeometry=True</span></code> if the expression requires access to the features geometry.
By default <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">handlesnull=True</span></code> if the expression has custom handling for NULL values.
If <code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code> (default), the result will always be NULL as soon as
any parameter is NULL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">referenced_columns=[list]</span></code>: An array of attribute names that are required to
the function. Defaults to <code class="docutils literal notranslate"><span class="pre">[QgsFeatureRequest.ALL_ATTRIBUTES]</span></code>.</p></li>
</ul>
<p>The previous example function can then be used in expressions:</p>
<figure class="align-center" id="id4">
<span id="figure-expression-custom-function"></span><img alt="../../../_images/customFunction.png" src="../../../_images/customFunction.png" />
<figcaption>
<p><span class="caption-number">Fig. 12.3 </span><span class="caption-text">Custom Function added to the Expression tab</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>Further information about creating Python code can be found in the
<a class="reference internal" href="../../pyqgis_developer_cookbook/index.html#pyqgis-developer-cookbook"><span class="std std-ref">PyQGIS Developer Cookbook</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="12. Level up with Expressions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="functions_list.html" class="btn btn-neutral float-right" title="12.2. List of functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">Last updated on Oct 24, 2021 11:42.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages
example of expected format: .../locale-en-lc-messages-docs-gentle-gis-introduction-data-capture-po--release-3-16 
for the page ...3.16/docs/gentle_gis_introduction/data_capture.html in release_3.16 branch-->
<!--Make sure that mismatching languages codes are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: testing
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/user_manual/expressions/expression.html">en</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/en/docs/user_manual/expressions/expression.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/en/docs/user_manual/expressions/expression.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/en/docs/user_manual/expressions/expression.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/en/docs/user_manual/expressions/expression.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/en/docs/user_manual/expressions/expression.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/en/docs/user_manual/expressions/expression.html">2.18</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.14/en/docs/user_manual/expressions/expression.html">2.14</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.8/en/docs/user_manual/expressions/expression.html">2.8</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.6/en/docs/user_manual/expressions/expression.html">2.6</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.2/en/docs/user_manual/expressions/expression.html">2.2</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.0/en/docs/user_manual/expressions/expression.html">2.0</a></dd>
        
          <dd><a href="https://docs.qgis.org/1.8/en/docs/user_manual/expressions/expression.html">1.8</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/testing/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/testing/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/user_manual/expressions/expression.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org/en" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/master" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/master" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>